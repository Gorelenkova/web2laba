<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина</title>
    <link rel="stylesheet" href="style/styleCart.css">
</head>
<body>
    <main id="main-holder">
        <h1 id="cart-title">Корзина</h1>

        <!-- Секция для товаров в корзине -->
        <div id="cart-items">
            <p id="empty-cart-message">Ваша корзина пуста. Добавьте товары!</p>
            <ul id="cart-list"></ul>
        </div>

        <!-- Кнопка оформления заказа -->
        <button id="checkout-button" style="display: none;" onclick="proceedToCheckout()">Оформить заказ</button>
    </main>

    <script>

document.addEventListener("DOMContentLoaded", () => {
    const userId = localStorage.getItem("userId");
    console.log("Полученный userId из localStorage:", userId);

    if (userId) {
       // fetchCartItems(userId); // Вызов функции с полученным userId
       fetchUserProducts(userId)
       fetchCartItems(userId)
    } else {
        console.log("userId отсутствует в localStorage.");
    }
});

function fetchUserProducts(userId) {
    console.log("Функция вызвана с userId:", userId);

    if (!userId) {
        console.log("Ошибка: не передан userId.");
        return;
    }

    const url = `http://localhost:8080/api/products/show?userId=${userId}`; // Измените URL на правильный для вашего API
    console.log("URL запроса:", url);

    fetch(url)
        .then(response => {
            console.log("Ответ от сервера:", response);
            if (!response.ok) {
                throw new Error("Ошибка при получении данных о продуктах пользователя");
            }
            return response.json(); // Парсим JSON
        })
        .then(data => {
            console.log("Данные, полученные от сервера:", data);

            if (Array.isArray(data) && data.length > 0) {
                // Обрабатываем массив данных
                data.forEach(product => {
                    console.log(`Продукт: ${product.productName}, Количество: ${product.quantity}, Цена: ${product.price}`);
                });

                // Обновляем DOM, например, список продуктов
                const productsListElement = document.getElementById('products-list');
                if (productsListElement) {
                    productsListElement.innerHTML = ''; // Очищаем старые данные

                    data.forEach(product => {
                        const productElement = document.createElement('div');
                        productElement.classList.add('product-item');
                        productElement.innerHTML = `
                            <h3>${product.productName}</h3>
                            <p>Описание: ${product.description}</p>
                            <p>Количество: ${product.quantity}</p>
                            <p>Цена: ${product.price}</p>
                            <img src="${product.imageUrl}" alt="${product.productName}" style="max-width: 100px;" />
                        `;
                        productsListElement.appendChild(productElement);
                    });
                }
            } else {
                console.log("У пользователя нет продуктов или данные некорректны.");
                const productsListElement = document.getElementById('products-list');
                if (productsListElement) {
                    productsListElement.innerHTML = `<p>У пользователя нет продуктов.</p>`;
                }
            }
        })
        .catch(error => {
            console.error("Ошибка при запросе данных о продуктах пользователя:", error);
        });
}


           function fetchCartItems(userId) {
    console.log("Функция вызвана с userId:", userId);

    if (!userId) {
        console.log("Ошибка: не передан userId.");
        return;
    }

    const url = `http://localhost:8080/cart/show?userId=${userId}`;
    console.log("URL запроса:", url);

    fetch(url)
        .then(response => {
            console.log("Ответ от сервера:", response);
            if (!response.ok) {
                throw new Error("Ошибка при получении данных корзины");
            }
            return response.json(); // Парсим JSON
        })
        .then(data => {
            console.log("Данные, полученные от сервера:", data);

            if (Array.isArray(data) && data.length > 0) {
                // Пример обработки массива данных
                let totalItems = 0;
                data.forEach(item => {
                    console.log(`Товар: ${item.productName}, Количество: ${item.quantity}`);
                    totalItems += item.quantity; // Считаем общее количество
                });

                const cartCountElement = document.getElementById('cart-count');
                if (cartCountElement) {
                    cartCountElement.textContent = `Товары в корзине: ${totalItems}`;
                }
            } else if (data && typeof data === "object") {
                // Если сервер возвращает объект
                console.log(`Товар: ${data.productName}, Количество: ${data.quantity}`);
                const cartCountElement = document.getElementById('cart-count');
                if (cartCountElement) {
                    cartCountElement.textContent = `Товары в корзине: ${data.quantity}`;
                }
            } else {
                console.log("Корзина пуста или данные некорректны.");
                const cartCountElement = document.getElementById('cart-count');
                if (cartCountElement) {
                    cartCountElement.textContent = `Корзина пуста`;
                }
            }
        })
        .catch(error => {
            console.error("Ошибка при запросе корзины:", error);
        });
}

    </script>
</body>
</html>
